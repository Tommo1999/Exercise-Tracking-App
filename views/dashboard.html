<!DOCTYPE html>
 <html lang="en">
 <head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
   <title>FitTrack Dashboard</title>
   <style>
     body {
       margin: 0;
       font-family: 'Segoe UI', sans-serif;
       background-color: #f4f6f8;
       color: #2c3e50;
     }
 
     .container {
       max-width: 1000px;
       margin: 0 auto;
       padding: 30px 20px;
     }
 
     .header {
       text-align: center;
       margin-bottom: 40px;
     }
 
     .header h1 {
       font-size: 2.5rem;
       margin-bottom: 10px;
     }
 
     .dashboard-section {
       display: flex;
       flex-wrap: wrap;
       gap: 20px;
       margin-bottom: 30px;
     }
 
     .card {
       background: white;
       padding: 20px;
       border-radius: 10px;
       box-shadow: 0 4px 12px rgba(0,0,0,0.08);
       flex: 1 1 calc(50% - 20px);
       min-width: 300px;
     }
 
     .card h2 {
       font-size: 1.5rem;
       margin-bottom: 10px;
     }
 
     .btn {
       background-color: #27ae60;
       color: white;
       padding: 12px 20px;
       border: none;
       border-radius: 5px;
       font-size: 1rem;
       cursor: pointer;
       margin-top: 15px;
       transition: background-color 0.3s;
     }
 
     .btn:hover {
       background-color: #219150;
     }
 
     .logout {
       background-color: #e74c3c;
     }
 
     .logout:hover {
       background-color: #c0392b;
     }
 
     .modal {
       display: none;
       position: fixed;
       z-index: 1000;
       left: 0;
       top: 0;
       width: 100%;
       height: 100%;
       overflow-y: auto;
       background-color: rgba(0, 0, 0, 0.5);
       padding-top: 40px;
     }
 
     .modal-content {
       background-color: white;
       margin: auto;
       padding: 20px;
       border-radius: 10px;
       width: 95%;
       max-width: 1000px;
       overflow-x: auto;
       max-height: 90%;
       overflow-y: auto;
     }
 
     .modal .close {
       color: #aaa;
       float: right;
       font-size: 28px;
       font-weight: bold;
     }
 
     .modal .close:hover,
     .modal .close:focus {
       color: black;
       text-decoration: none;
       cursor: pointer;
     }
 
     table {
       width: 100%;
       border-collapse: collapse;
       margin-bottom: 20px;
     }
 
     th, td {
       border: 1px solid #ddd;
       padding: 8px;
       text-align: center;
     }
 
     th {
       background-color: #27ae60;
       color: white;
     }
 
     input[type="number"] {
       width: 70px;
       padding: 5px;
       font-size: 0.9rem;
     }
 
     .set-weight-dropdown {
       width: 80px;
       padding: 5px;
       font-size: 0.9rem;
     }
 
     #add-exercise-row-btn {
       margin-bottom: 20px;
       background-color: #2980b9;
     }
 
     #add-exercise-row-btn:hover {
       background-color: #1c5985;
     }
 
     #save-workout-btn {
       background-color: #27ae60;
       margin-left: 10px;
     }
 
     #save-workout-btn:hover {
       background-color: #219150;
     }
 
     #edit-workout-btn {
       background-color: #f39c12;
     }
 
     #edit-workout-btn:hover {
       background-color: #e67e22;
     }
 
     #delete-workout-btn {
       background-color: #e74c3c;
     }
 
     #delete-workout-btn:hover {
       background-color: #c0392b;
     }
 
     .modal label {
       display: inline-block;
       margin-right: 10px;
       font-weight: bold;
     }
 
     .modal input[type="text"], .modal input[type="date"] {
       padding: 8px;
       font-size: 0.85rem;
       margin-bottom: 15px;
     }
 
     .exercise-row td:first-child input[type="text"] {
       font-size: 0.75rem;
       width: 100%;
       padding: 4px;
       max-width: 130px;
       box-sizing: border-box;
     }
 
     .exercise-row td:first-child {
       display: flex;
       flex-direction: column;
       align-items: center;
     }
 
     .exercise-row td:first-child input[type="text"] {
       margin-top: 5px;
       width: 100%;
       font-size: 0.8rem;
       padding: 6px;
       text-align: center;
     }
 
     .modal-header {
       display: flex;
       justify-content: space-between;
       align-items: center;
     }
 
     .modal-header .btn-container {
       display: flex;
       gap: 10px;
     }
 
     /* New styles for horizontal scroll */
     .horizontal-scroll {
       overflow-x: auto;
       width: 100%;
       margin-bottom: 20px;
     }
 
     .horizontal-scroll table {
       min-width: 1000px;
     }
 
     .modal .question {
       margin-bottom: 20px;
     }
 
     .modal .question input {
       padding: 8px;
       margin-top: 10px;
     }
 
     .modal .question select {
       padding: 8px;
       margin-top: 10px;
     }
 
     .modal .question textarea {
       padding: 8px;
       margin-top: 10px;
       width: 100%;
       height: 100px;
     }
 
     .modal-header {
       display: flex;
       justify-content: space-between;
       align-items: center;
     }
 
     .modal-header .btn-container {
       display: flex;
       gap: 10px;
     }
 
 .modal {
   display: none;
   position: fixed;
   z-index: 1;
   left: 0;
   top: 0;
   width: 100%;
   height: 100%;
   overflow: auto;
   background-color: rgba(0, 0, 0, 0.5);
 }
 
 .modal-content {
   background-color: white;
   margin: 15% auto;
   padding: 20px;
   border: 1px solid #888;
   width: 80%;
 }
 
   </style>
 </head>
 <body>
 
 <div class="container">
   <div class="header">
     <h1 id="welcome-message">Welcome!</h1>
     <p>Track your workouts and fitness journey</p>
   </div>
 
   <div class="dashboard-section">
     <div class="card">
       <h2>Recent Workouts</h2>
       <p id="no-workouts" class="empty-message">No workouts added yet.</p>
       <ul id="recent-workouts-list" style="display: none;"></ul>
       <button class="btn" id="add-workout-btn">Create Workout</button>
     </div>
 
     <div class="card">
       <h2>Download Workouts</h2>
       <p>Download your workouts as a spreadsheet.</p>
       <button class="btn" id="download-btn">Download as Excel</button>
     </div>
   </div>
 
   <div style="text-align: center; margin-top: 40px;">
     <button class="btn logout" onclick="logout()">Logout</button>
   </div>
 </div>
 
 <!-- Workout Details Modal (Popup) -->
 <div id="workout-details-modal" class="modal">
   <div id="workout-details-content" class="modal-content"></div>
   <span class="close" id="close-workout-details">&times;</span>
 </div>
 
 <!-- Workout Modal -->
 <div id="create-workout-modal" class="modal">
   <div class="modal-content">
     <span class="close" id="close-workout-modal">&times;</span>
 
     <div class="modal-header">
       <div>
         <label for="workout-name">Workout:</label>
         <input type="text" id="workout-name" placeholder="e.g. Upper Body" />
       </div>
       <div class="btn-container">
         <button id="save-workout-btn">Save Workout</button>
       </div>
     </div>
 
     <label for="workout-date">Date:</label>
     <input type="date" id="workout-date" />
 
    <!-- Horizontal scroll container for the table -->
 <div class="horizontal-scroll">
   <table>
     <thead>
       <tr>
         <th>Exercise</th>
         <th>Unit</th>
         <th colspan="2">Set 1</th>
         <th colspan="2">Set 2</th>
         <th colspan="2">Set 3</th>
         <th colspan="2">Set 4</th>
         <th colspan="2">Set 5</th>
         <th colspan="2">Set 6</th>
       </tr>
       <tr>
         <th></th>
         <th>Weight Unit</th>
         <th>Weight</th><th>Reps</th>
         <th>Weight</th><th>Reps</th>
         <th>Weight</th><th>Reps</th>
         <th>Weight</th><th>Reps</th>
         <th>Weight</th><th>Reps</th>
         <th>Weight</th><th>Reps</th>
       </tr>
     </thead>
     <tbody id="exercise-rows">
       <!-- Row A is initially present -->
       <tr class="exercise-row" data-index="0">
         <td><strong>A.</strong>
           <input type="text" placeholder="Exercise name" />
         </td>
         <td>
           <select class="set-weight-dropdown">
             <option value="kg">kg</option>
             <option value="lbs">lbs</option>
           </select>
         </td>
         <!-- Set 1 -->
         <td>
           <input type="number" placeholder="Weight" />
         </td>
         <td><input type="number" placeholder="reps" /></td>
         <!-- Set 2 -->
         <td>
           <input type="number" placeholder="Weight" />
         </td>
         <td><input type="number" placeholder="reps" /></td>
         <!-- Set 3 -->
         <td>
           <input type="number" placeholder="Weight" />
         </td>
         <td><input type="number" placeholder="reps" /></td>
         <!-- Set 4 -->
         <td>
           <input type="number" placeholder="Weight" />
         </td>
         <td><input type="number" placeholder="reps" /></td>
         <!-- Set 5 -->
         <td>
           <input type="number" placeholder="Weight" />
         </td>
         <td><input type="number" placeholder="reps" /></td>
         <!-- Set 6 -->
         <td>
           <input type="number" placeholder="Weight" />
         </td>
         <td><input type="number" placeholder="reps" /></td>
       </tr>
     </tbody>
   </table>
 </div>
 
 <button id="add-exercise-row-btn" type="button">Add Another Exercise</button>
 
     <!-- New questions under the workout table -->
     <div class="question">
       <label>Did you progress your lifts? (Yes/No)</label>
       <select>
         <option value="yes">Yes</option>
         <option value="no">No</option>
       </select>
     </div>
 
     <div class="question">
       <label>Have you marked the exercise where you are to progress next session? (Yes/No)</label>
       <select>
         <option value="yes">Yes</option>
         <option value="no">No</option>
       </select>
     </div>
 
     <div class="question">
       <label>How do you feel the workout went? (1-10)</label>
       <input type="number" min="1" max="10" />
     </div>
 
     <div class="question">
       <label>Additional Workout Notes</label>
       <textarea placeholder="Write any notes..." rows="4"></textarea>
     </div>
 
     <div class="question">
       <label>Cardio:</label>
       <textarea placeholder="Describe your cardio workout..." rows="4"></textarea>
     </div>
 
     <!-- Buttons for editing and deleting workouts -->
     <button id="edit-workout-btn" style="display:none;">Edit Workout</button>
     <button id="delete-workout-btn" style="display:none;">Delete Workout</button>
   </div>
 </div>
 
 <script>
 document.addEventListener("DOMContentLoaded", () => {
   const welcomeMessage = document.getElementById("welcome-message");
   const username = localStorage.getItem("username");
   welcomeMessage.textContent = username ? `Welcome, ${username}!` : "Welcome!";
 
   const modal = document.getElementById("create-workout-modal");
   const addWorkoutBtn = document.getElementById("add-workout-btn");
   const closeModal = document.getElementById("close-workout-modal");
   const addExerciseRowBtn = document.getElementById("add-exercise-row-btn");
   const exerciseRowsContainer = document.getElementById("exercise-rows");
 
   const recentWorkoutsList = document.getElementById("recent-workouts-list");
   const noWorkoutsMessage = document.getElementById("no-workouts");
 
   // Fetch and display recent workouts
   function loadRecentWorkouts() {
     if (!username) return;
 
     fetch(`/get-workouts?username=${encodeURIComponent(username)}`)
       .then(res => res.json())
       .then(workouts => {
         recentWorkoutsList.innerHTML = "";
 
         if (workouts.length === 0) {
           noWorkoutsMessage.style.display = "block";
           recentWorkoutsList.style.display = "none";
         } else {
           noWorkoutsMessage.style.display = "none";
           recentWorkoutsList.style.display = "block";
 
           workouts.slice(0, 5).forEach(w => {
             const li = document.createElement("li");
             li.textContent = `${w.date} - ${w.workout}`;
             li.dataset.workoutId = w.id;  // Add workout ID to the list item
             li.addEventListener("click", () => showWorkoutDetails(w)); // Add click event to show details
             recentWorkoutsList.appendChild(li);
           });
         }
       })
       .catch(err => {
         console.error("Failed to load workouts:", err);
       });
   }
 
   // Show workout details in a popup modal
   function showWorkoutDetails(workout) {
     const workoutDetailsModal = document.getElementById("workout-details-modal");
     const workoutDetailsContent = document.getElementById("workout-details-content");
 
     // Clear previous content
     workoutDetailsContent.innerHTML = "";
 
     // Populate modal with workout details
     const workoutDetails = `
       <h2>${workout.workout} - ${workout.date}</h2>
       <h3>Exercises:</h3>
       <ul>
         ${workout.exercises.map(exercise => `
           <li>
             <strong>${exercise.name}</strong>
             <ul>
               ${exercise.sets.map(set => `
                 <li>Weight: ${set.weight} ${exercise.weightUnit} | Reps: ${set.reps}</li>
               `).join("")}
             </ul>
           </li>
         `).join("")}
       </ul>
       <h3>Progress:</h3>
       <p>Progress Your Lifts: ${workout.progressYourLifts}</p>
       <p>Progress for Next Session: ${workout.progressForNextSession}</p>
       <p>Rating: ${workout.workoutRating}</p>
       <h3>Notes:</h3>
       <p>${workout.additionalNotes}</p>
       <h3>Cardio:</h3>
       <p>${workout.cardio}</p>
     `;
 
     workoutDetailsContent.innerHTML = workoutDetails;
 
     // Show the modal
     workoutDetailsModal.style.display = "block";
     document.body.style.overflow = "hidden";
   }
 
   // Close the workout details modal
   const closeWorkoutDetailsModal = document.getElementById("close-workout-details-modal");
   closeWorkoutDetailsModal.addEventListener("click", () => {
     const workoutDetailsModal = document.getElementById("workout-details-modal");
     workoutDetailsModal.style.display = "none";
     document.body.style.overflow = "";
   });
 
   // Save workout
   document.getElementById("save-workout-btn").addEventListener("click", () => {
     const workout = document.getElementById("workout-name").value.trim();
     const date = document.getElementById("workout-date").value;
     const progressYourLifts = document.querySelectorAll(".question select")[0].value;
     const progressForNextSession = document.querySelectorAll(".question select")[1].value;
     const workoutRating = parseInt(document.querySelectorAll(".question input[type='number']")[0].value) || null;
     const additionalNotes = document.querySelectorAll(".question textarea")[0].value;
     const cardio = document.querySelectorAll(".question textarea")[1].value;
 
     const exerciseRows = Array.from(document.querySelectorAll(".exercise-row"));
     const exercises = exerciseRows.map(row => {
       const name = row.querySelector("input[type='text']").value;
       const weightUnit = row.querySelector("select").value;
       const inputs = row.querySelectorAll("input[type='number']");
 
       const sets = [];
       for (let i = 0; i < inputs.length; i += 2) {
         const weight = parseFloat(inputs[i].value);
         const reps = parseInt(inputs[i + 1].value);
         if (!isNaN(weight) && !isNaN(reps)) {
           sets.push({ weight, reps });
         }
       }
 
       return { name, weightUnit, sets };
     }).filter(ex => ex.sets.length > 0 && ex.name);
 
     if (!username || !workout || !date || exercises.length === 0) {
       alert("Please fill in all required fields.");
       return;
     }
 
     const workoutData = {
       username,
       workout,
       date,
       exercises,
       progressYourLifts,
       progressForNextSession,
       workoutRating,
       additionalNotes,
       cardio,
     };
 
     fetch("/add-workout", {
       method: "POST",
       headers: { "Content-Type": "application/json" },
       body: JSON.stringify(workoutData)
     })
       .then(res => res.json())
       .then(data => {
         alert("Workout saved successfully!");
         console.log("Saved workout:", data);
         modal.style.display = "none";
         document.body.style.overflow = "";
         resetWorkoutForm();
 
         // Update recent workouts list immediately
         loadRecentWorkouts();
       })
       .catch(err => {
         console.error("Failed to save workout:", err);
         alert("Error saving workout. Check console for details.");
       });
   });
 
   function resetWorkoutForm() {
     document.getElementById("workout-name").value = "";
     document.getElementById("workout-date").value = "";
     exerciseRowsContainer.innerHTML = "";
 
     const row = document.createElement("tr");
     row.className = "exercise-row";
     row.setAttribute("data-index", "0");
     row.innerHTML = ` 
       <td><strong>A.</strong>
         <input type="text" placeholder="Exercise name" />
       </td>
       <td>
         <select class="set-weight-dropdown">
           <option value="kg">kg</option>
           <option value="lbs">lbs</option>
         </select>
       </td>
       ${[...Array(6)].map(() => `
         <td><input type="number" placeholder="Weight" /></td>
         <td><input type="number" placeholder="Reps" /></td>
       `).join("")}
     `;
     exerciseRowsContainer.appendChild(row);
   }
 
   addWorkoutBtn.addEventListener("click", () => {
     modal.style.display = "block";
     document.body.style.overflow = "hidden";
   });
 
   closeModal.addEventListener("click", () => {
     modal.style.display = "none";
     document.body.style.overflow = "";
   });
 
   window.addEventListener("click", (event) => {
     if (event.target === modal) {
       modal.style.display = "none";
       document.body.style.overflow = "";
     }
   });
 
   addExerciseRowBtn.addEventListener("click", () => {
     const index = exerciseRowsContainer.children.length;
     const row = document.createElement("tr");
     row.className = "exercise-row";
     row.setAttribute("data-index", index);
     row.innerHTML = `
       <td><strong>${String.fromCharCode(65 + index)}.</strong>
         <input type="text" placeholder="Exercise name" />
       </td>
       <td>
         <select class="set-weight-dropdown">
           <option value="kg">kg</option>
           <option value="lbs">lbs</option>
         </select>
       </td>
       ${[...Array(6)].map(() => `
         <td><input type="number" placeholder="Weight" /></td>
         <td><input type="number" placeholder="Reps" /></td>
       `).join("")}
     `;
     exerciseRowsContainer.appendChild(row);
   });
 
   const logoutBtn = document.querySelector(".logout");
   logoutBtn.addEventListener("click", () => {
     localStorage.removeItem("username");
     window.location.href = "/login";
   });
 
   // Auto-load recent workouts on page load
   loadRecentWorkouts();
 });
 
 </script>
 
 </body>
 </html>


